1. rusthound
```
$ sudo rusthound -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 --domain inlanefreight.local -c all 

zip -r ilfreight_bh.zip *.json
```



```shell-session
$ sudo bloodhound-python -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 -d inlanefreight.local -c all 

zip -r ilfreight_bh.zip *.json
```

 
 `running the SharpHound.exe collector from the MS01 attack host.`
```powershell-session
PS C:\htb> .\SharpHound.exe -c All --zipfilename ILFREIGHT
```

also manually zip
```
`Compress-Archive -Path *.json -DestinationPath sharpdump.zip`
```


## AD Data Collection Methods

### soap: used in soaphound,soaPy, and rusthound uses the ADWS protocol to query ldap
![[Pasted image 20250731140745.png|1000]]
 
## important information queries:
- outbound object control
![[bh-analysis 1.webp]]
sharphound from windows when powershell is blocked

 `running the SharpHound.exe collector from the MS01 attack host.`
```powershell-session
PS C:\htb> .\SharpHound.exe -c All --zipfilename ILFREIGHT
```

also manually zip
```
`Compress-Archive -Path *.json -DestinationPath sharpdump.zip`
```

We will often see users with local admin rights on their host (perhaps temporarily to install a piece of software, and the rights were never removed), or they occupy a high enough role in the organization to demand these rights (whether they require them or not). Other times we'll see excessive local admin rights handed out across the organization, such as multiple groups in the IT department with local admin over groups of servers or even the entire Domain Users group with local admin over one or more hosts. This can benefit us if we take over a user account with these rights over one or more machines. We can run the query `Find Computers where Domain Users are Local Admin` to quickly see if there are any hosts where all users have local admin rights. If this is the case, then any account we control can typically be used to access the host(s) in question, and we may be able to retrieve credentials from memory or find other sensitive data.

We can start by typing `domain:` in the search bar on the top left and choosing `INLANEFREIGHT.LOCAL` from the results. Take a moment to browse the node info tab. As we can see, this would be a rather large company with over 550 hosts to target and trusts with two other domains.

Now, let's check out a few pre-built queries in the `Analysis` tab. The query `Find Computers with Unsupported Operating Systems` is great for finding outdated and unsupported operating systems running legacy software.

Keeping these hosts around may save money, but they also can add unnecessary vulnerabilities to the network. 

Older hosts may be susceptible to older remote code execution vulnerabilities like [MS08-067](https://support.microsoft.com/en-us/topic/ms08-067-vulnerability-in-server-service-could-allow-remote-code-execution-ac7878fc-be69-7143-472d-2507a179cd15). If we come across these older hosts during an assessment, we should be careful before attacking them (or even check with our client) as they may be fragile and running a critical application or service.
We can advise our client to segment these hosts off from the rest of the network as much as possible if they cannot remove them yet, but should also recommend that they start putting together a plan to decommission and replace them.

This query shows two hosts, one running Windows 7 and one running Windows Server 2008 (both of which are not "live" in our lab).

Sometimes we will see hosts that are no longer powered on but still appear as records in AD. We should always validate whether they are "live" or not before making recommendations in our reports. We may write up a high-risk finding for Legacy Operating Systems or a best practice recommendation for cleaning up old records in AD.

#### Unsupported Operating Systems

![text](https://academy.hackthebox.com/storage/modules/143/unsupported.png)

We will often see users with local admin rights on their host (perhaps temporarily to install a piece of software, and the rights were never removed), or they occupy a high enough role in the organization to demand these rights (whether they require them or not).

Other times we'll see excessive local admin rights handed out across the organization, such as multiple groups in the IT department with local admin over groups of servers or even the entire Domain Users group with local admin over one or more hosts.

This can benefit us if we take over a user account with these rights over one or more machines. We can run the query `Find Computers where Domain Users are Local Admin` to quickly see if there are any hosts where all users have local admin rights. If this is the case, then any account we control can typically be used to access the host(s) in question, and we may be able to retrieve credentials from memory or find other sensitive data.

#### Local Admins

![text](https://academy.hackthebox.com/storage/modules/143/local-admin.png)

cipher cheatsheet
https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/
![[bh-analysis 1.webp]]


 Keep in mind as we go through the engagement, we should be documenting every file that is transferred to and from hosts in the domain and where they were placed on disk. This is good practice if we have to deconflict our actions with the customer. Also, depending on the scope of the engagement, you want to ensure you cover your tracks and clean up anything you put in the environment at the conclusion of the engagement.